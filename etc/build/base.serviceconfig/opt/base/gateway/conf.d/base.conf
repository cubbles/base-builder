server {
    listen 80 default_server;
    server_name  _;
    include /opt/base/gateway/conf.d/base.ssl;
    set_by_lua_block $auth_secret {return os.getenv("BASE_AUTH_SECRET")}

    # Look at how nginx chooses a location to process a request
    # ----------------------------------------------------------
    # nginx first searches for the most specific prefix location given by literal strings
    # regardless of the listed order. In the configuration above the only prefix location is “/”
    # and since it matches any request it will be used as a last resort.
    # Then nginx checks locations given by regular expression in the order
    # listed in the configuration file.
    # The first matching expression stops the search and nginx will use this location.
    # If no regular expression matches a request, then nginx uses
    # the most specific prefix location found earlier.
    #
    # Source: http://nginx.org/en/docs/http/request_processing.html#simple_php_site_configuration

    include /opt/base/gateway/conf.d/base.locations;
    include /opt/base/gateway/conf.d/proxy/proxy_*.locations;

    # default
    location ~ /$ {
        return 200 'Cubbles. A platform for component based client-side webapps.';
        add_header Content-Type text/plain;
    }
}